@inherits LayoutComponentBase
@using FE_HumanResources.Entities
@using FE_HumanResources.Models
@inject ILocalStorageService LocalStorage
@inject NavigationManager NavigationManager

@if (userModel == null)
{
    <FE_HumanResources.Pages.Login />
}
else
{
    <RadzenLayout class="page">
        <RadzenHeader>
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0">
                <RadzenSidebarToggle Click="@(() => sidebarExpanded = !sidebarExpanded)" />
                <img src="source/branding-institucional/Logo.png" alt="" width="32px">
                <RadzenLabel Text="Industrias Francelli" />
                <TopMenu />
            </RadzenStack>
        </RadzenHeader>
        <RadzenSidebar Responsive="false" @bind-Expanded="@sidebarExpanded" style="position: absolute; z-index: 3">
            <div>
                <SideBar />
            </div>
        </RadzenSidebar>
         <RadzenBody Gap="1rem" Class="rz-p-sm-12"  Style="Width:100%; height:100%; overflow-y:auto; overflow-x:auto;">
            @Body
        </RadzenBody>
        @if (sidebarExpanded)
        {
            <div @onclick="@(() => sidebarExpanded = false)" class="rz-dialog-mask" style="position: absolute; z-index: 2"></div>
        }
        <RadzenFooter class="rz-text-align-center">
            Industrias Francelli Todos los Derechos Reservados @Year
        </RadzenFooter>
        
    </RadzenLayout>

}

<RadzenComponents />
<RadzenContextMenu />
<RadzenNotification />
<RadzenDialog />
<RadzenTooltip />

@code {
    private int Year;
    bool sidebarExpanded = true;
    private UserEntity? userModel = new UserEntity();
    protected override async Task OnInitializedAsync()
    {
        Year = DateTime.Now.Year;
        userModel = null;
        string? usr = await LocalStorage.GetItemAsync<string>("logedUser");

        if (!string.IsNullOrEmpty(usr))
        {
            userModel = JsonConvert.DeserializeObject<UserEntity>(usr);
        }
    }
}